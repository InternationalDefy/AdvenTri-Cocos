先行测验上次内容的实现程度，今天考虑移植到Enemy类以及NPC的构建？
经试验真是酷毙了！

现在考虑拓展方法的记录和Enemy类的移植

拓展方法：
1：当需要添加一个新的PlyaerState状态类时
A 在Ref_State中注册.h头文件
B 先实现对应的Player类方法，可能需要添加新的技能类，在.h文件和activities.cpp中
C 继承自M_PlayerState基类，修改需要注意的派生方法
D 具体的ExitTo配发方法在M_PlayerState基类中有所描述，不同的exitTo可能需要getPlayer考虑初状态和目的状态的设置
E 退出State的方法需要实现的目标比较繁杂，Gather的ExitTo要调用技能的释放，Use的ExitTo要考虑M_Player当前的互动对象等
F 退出State的操作同时需要实现动画和逻辑的修改更新。进入State的操作也需要动画和逻辑的修改和更新。
2：技能类的拓展方法
A 在Ref_State中注册.h文件
B 在分拣类SD_PSkill中注册分拣方法
C 添加技能类继承自M_pSkill，写create函数
D 重写Init和active方法，

现在考虑给Enemy类添加State：
先考虑：
Enemy类需要添加State吗？
从必要性考虑：
一些Enemy确实会进入不同State以使用不同方法，比如重装兵可能会进入DefenseState 法师会进入GatherState 盗贼会进入DashState，
同一个敌人类实体的行为没有主角类丰富，所以一种实体的进入State通常只有一种。
如果一个实体使用最多一种State，完全可以使用bool StateOn来判断其类型和回调。
但这样又会有在Enemy类大量bool State出现，而且它们可以响应不同类型的回调却难以驱动不同的行为。
派生类是一种实现的方法，其一种派生类拥有一个bool onState，也可以定义Enum类 AdvenTriEnum::EnemyState 在Enemy基类中持有其实例，其可以驱动行为。但相当复杂。

最终决定继续使用类似于PState的实现方法，现在的问题是
1：Controller的update方法不能够实际起到作用，最好修改。
2：ControllerAI和ControllerSimple都需要重新一个实现方法。
3：这里需要在Controller里实现脏标记模式的使用。
4：需要一个EnemyState类，控制对State的分发。
5：EnemyDebuff类更加复杂，因为Amor Weapon也要考虑其特效。
*****************
以上为11日日志
*****************
先为实现技能类的内存管理考虑了一阵，直接去掉addChild即可。。。
修改Controller类从名字开始，把无用的操作也需要修改。
修改方法：把entity在执行操作的判断方法改到了Controller类中，这样可以在C和M上解耦。
同时把Move操作和Update剥离开来，在Update中判断是否在执行操作以控制时间间隔。
*****************
以上为12日日志
*****************
修改控制器系统之后实体抖动极其明显，尚不清楚问题所在，先在pCtrl中修改，把pCtrl和Controller分离开来。
经修正之后得以解决。应该是调用体系越深调用时间越久，则精确度逐渐下降。
这里牵扯到一个设计上的问题：是否需要给Enemy类的Skill加入冷却时间，考虑到后期使用AICtrl可能需要访问冷却时间，但是sCtrl也会如此，所以需要一个能控制其访问间隔时间大于冷却时间的机制，这是一笔不小的消耗。在Ctrl中实现冷却时间的机制也不是不可能，但是要考虑到的数据量会比较难以估计。此举可以通过在Ctrl上拓展以实现。
所以要实现技能系统和Action对Enemy的调用，还需要先修改Ctrl。
而State类的实现无疑是依赖于Skill和Action以及Hurt三个系统的统一实现的。
修改Enemy的Ref体系，现在尽量在一个文件中实现对应的操作。再考虑对Debuff在Enemy类上的实现。
初步实现Debuff和Hurt对Enemy的移植，考虑其需要结合AmorType来计算伤害。先考虑初步实现及其拓展方法。
重新设置了Amor类的AnimationPack和DB，预备为其加入扩展方法以实现对Damage和Debuff的计算。
罪魁祸首就是C4305 注意以后要用.xf，阶段性彻底解决了抖动问题。

这里首先考虑AmorType的响应问题，响应应当对某一种Type响应？还是对所有Type均有响应（但有实际效果的就是几类）？
其实可以这样设计：都会触发Animation的改变，但是有逻辑操作的状态只有特定的一种或几种，逻辑操作还有可能触发动画变更。

DB的拓展现已完成。